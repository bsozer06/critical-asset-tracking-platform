<div class="telemetry-panel">
  <!--<div class="telemetry-header">
    <mat-icon class="telemetry-icon">sensors</mat-icon>
    <span class="telemetry-title">Asset Telemetry</span>
  </div>-->
  <mat-form-field appearance="outline" class="filter-field">
    <mat-label>Search Assets</mat-label>
    <input matInput (keyup)="applyFilter($event)" placeholder="Type to filter...">
    <button mat-icon-button matSuffix *ngIf="filterValue" (click)="filterValue=''; applyFilterInternal();">
      <mat-icon>close</mat-icon>
    </button>
  </mat-form-field>
  <cdk-virtual-scroll-viewport itemSize="64" class="table-viewport">
    <table mat-table [dataSource]="filteredAssets" class="mat-elevation-z2 asset-table">
      <!-- ID Column -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef> ID </th>
        <td mat-cell *matCellDef="let asset"> <span class="asset-id">{{asset.id}}</span> </td>
      </ng-container>
      <!-- Location Column -->
      <ng-container matColumnDef="location">
        <th mat-header-cell *matHeaderCellDef> Location </th>
        <td mat-cell *matCellDef="let asset"> <span class="asset-location">{{asset.location}}</span> </td>
      </ng-container>
      <!-- Speed Column -->
      <ng-container matColumnDef="speed">
        <th mat-header-cell *matHeaderCellDef> Speed </th>
        <td mat-cell *matCellDef="let asset"> <span class="asset-speed">{{asset.speed}}</span> </td>
      </ng-container>
      <!-- Date Column -->
      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef> Date </th>
        <td mat-cell *matCellDef="let asset"> <span class="asset-date">{{asset.date | date:'short'}} </span></td>
      </ng-container>
      <!-- Row Detail Toggle -->
      <ng-container matColumnDef="expand">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let asset">
          <button mat-icon-button (click)="toggleRow(asset)" [attr.aria-label]="expandedAsset === asset ? 'Hide details' : 'Show details'">
            <mat-icon>{{expandedAsset === asset ? 'expand_less' : 'expand_more'}}</mat-icon>
          </button>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" [class.selected-row]="expandedAsset === row"></tr>
      <ng-container *ngFor="let row of filteredAssets">
        <tr *ngIf="expandedAsset === row" class="detail-row">
          <td colspan="5">
            <div class="asset-detail-card">
              <div class="asset-detail-header">
                <mat-icon>info</mat-icon>
                <span>Asset Details</span>
              </div>
              <div class="asset-detail-content">
                <div><strong>ID:</strong> {{row.id}}</div>
                <div><strong>Location:</strong> {{row.location}}</div>
                <div><strong>Speed:</strong> {{row.speed}}</div>
                <div><strong>Date:</strong> {{row.date | date:'full'}} </div>
              </div>
            </div>
          </td>
        </tr>
      </ng-container>
    </table>
    <div *ngIf="filteredAssets.length === 0" class="empty-state">
      <mat-icon>search_off</mat-icon>
      <span>No assets found.</span>
    </div>
  </cdk-virtual-scroll-viewport>
</div>
